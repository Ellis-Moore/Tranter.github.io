
<?php 
			require_once 'login-files/access.php' ;
			require_once 'login-files/config.php';
?>
<html>
<head>
    <title>TFP Management System</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">   
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="Dashboard.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    
    <script>
        $(document).ready(function(){  
            function verifytoken(){
                    /**
                    *  Functon to check token if login was validated 
                    
                    *  VARIABLES
                    *   sessionStorage.getItem("token")    string   Holds the previosly set value of token from when logged in 
                    *   token                              key-value pair   Data sent to php document to be validated containing token 
                    
                    *  ALGORITHM
                    
                    *  IF Token doesn't exist in session storage THEN
                    *       Send user back to login page
                    *  END IF 
                    
                    *  token <- Object(Token)
                    *  Post token to verifyJWT.php
                    *  IF JSON.strigify(Token) != true
                    *       Send user back to login page
                    *  ELSE
                    *       Store login data and continue with session
                    *  END IF 
                    
                    */
                    
                    // Checks if there's any token at all if true returns you to login page 
                    if(sessionStorage.getItem("token") == null){
                        alert("No token found")
                        window.location.assign("../first.html")
                    }
                    
                    // creates key-value pair to be posted
                    var token = {token: sessionStorage.getItem("token")}
                    // Posting proccess of sending of key-value pair
                    var posting = $.post("Login-files/verifyJWT.php",
                            JSON.stringify(token),
                                        
                                function(data){
                               
                                // If unsuccessful boot user off page
                                if(data[0] != true) {
										alert("Invalid token found.");
                                        window.location.assign("index.html")
									}else{
                                        // Collect login data 
                                        var logindata = data[1]
                                        
                                        console.log(logindata)
                                        // store data in sessionStorage for later use 
                                        sessionStorage.setItem("landlordID", logindata.userId)
                                        sessionStorage.setItem("loginTime", logindata.loginTime)
                                        sessionStorage.setItem("loginDate", logindata.loginDate)
                                        sessionStorage.setItem("username", logindata.username)
									    
                                        
										
									}
                                })
                }
            setTimeout(function() {
                var content = "<label><b>Username : </b>"+ sessionStorage.getItem("username") +"</label><br>"
                content += "<label><b>ID : </b>"+ sessionStorage.getItem("landlordID") + "</label><br>"
                content += "<label><b>Logged in since : </b> "+ sessionStorage.getItem("loginTime") +"</label><br>"
                $("#ProfileSlab").html(content)
            }, 500);
            function profile(){
                
            }
            
            verifytoken();
            profile();
            
        })
        
    </script>
</head>
    
<body background="images/shattered-island.gif">
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
        </div>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
            <center><h2 class="titletext" colour= "#fff" >TFP (Wakefield LTD) </h2></center>
        </div>
    </nav>
    <br>
        
    <div class="col-sm-1 tool-box" >
        <ul>
          <li><a href="dashboard.html">Dashboard</a></li>
          <li><a href="tenants/tenantview.html">Tenants</a></li>
          <li><a href="properties/propertyview.html">Properties</a></li>
          <li><a href="about.asp">About</a></li>
          <br>
          <li><a class="logoutbtn" href="index.html">Logout</a></li>
        </ul>
    </div>

    <div class="col-sm-9 box">
        <img src="images/blank-avatar.png" alt="Avatar" class="col-sm-3 avatar">
        <div id="ProfileSlab"></div>
    </div>
    <div class="col-sm-1 contactbox">
        <center>
            <label>Contact Information</label><br><br>
            <p1>Reception number :  07957970570</p1><br>
            <p1>Desk number : 07957970570</p1><br>
            <p1>Personal number : 07957970570</p1><br>
            <p1>E-mail : example@jrnaylors.com</p1><br>
        </center>
    </div>    
</body>
</html>